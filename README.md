# AI Background Agent v4.0

–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ AI –∞–≥–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Initial Prompt, –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ —Ñ–∞–∑–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **AI Background Agent (Agent2)** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º:
  - ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Initial Prompt –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
  - ‚úÖ –ü—Ä–∏–µ–º –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —á–µ—Ä–µ–∑ WebSocket, REST API –∏ —Ñ–∞–π–ª—ã
  - ‚úÖ –§–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á (phase-1, phase-2, etc.)
  - ‚úÖ –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
  - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã

- **TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Agent1** (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- **–ì–∏–±–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backgroundAgent/
‚îú‚îÄ‚îÄ cursor-agent.js                 # Agent1 (TCP —Å–µ—Ä–≤–µ—Ä)
‚îú‚îÄ‚îÄ cursor-agent-secondary.js       # AI Background Agent (Agent2)
‚îú‚îÄ‚îÄ package.json                    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ logs/                          # –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ instructions/                  # –í—Ö–æ–¥—è—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (—Ñ–∞–π–ª—ã .txt)
‚îî‚îÄ‚îÄ results/                       # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–∞–∑
```

## üèÉ‚Äç‚ôÇÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ AI Background Agent

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±
npm run ai-agent

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã
npm run agent2
npm run start:ai-agent
npm run run:ai-agent
```

### 2. –ó–∞–ø—É—Å–∫ —Å Agent1 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
npm run agent1
# –∏–ª–∏
npm run start:agent1
```

## üì° –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

### 1. WebSocket (–ø–æ—Ä—Ç 3020)

```javascript
const WebSocket = require('ws');
const ws = new WebSocket('ws://localhost:3020');

ws.on('open', () => {
    ws.send('–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–µ–∫—Ç–∞');
});

ws.on('message', (data) => {
    console.log('–û—Ç–≤–µ—Ç:', JSON.parse(data));
});
```

### 2. REST API (–ø–æ—Ä—Ç 3021)

**–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:**
```bash
curl -X POST http://localhost:3021/instruction \
  -H "Content-Type: application/json" \
  -d '{"instruction": "–°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã"}'
```

**–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞:**
```bash
curl http://localhost:3021/status
```

### 3. –§–∞–π–ª–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–æ–∑–¥–∞–π—Ç–µ `.txt` —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `instructions/`:

```bash
echo "–í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" > instructions/task1.txt
```

–§–∞–π–ª –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω –≤ `results/`.

## üéØ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∞–≥–µ–Ω—Ç–∞

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** 
   - –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (logs/, instructions/, results/)
   - –ó–∞–ø—É—Å–∫ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (WebSocket, REST, File monitor)
   
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Agent1** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   - TCP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç 3001
   - –•—ç–Ω–¥—à–µ–π–∫ —Å Agent1
   
3. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Initial Prompt**
   - AI –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã (2 —Å–µ–∫—É–Ω–¥—ã)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ results/initial-*.json
   
4. **–û–∂–∏–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π**
   - –ü—Ä–∏–µ–º —á–µ—Ä–µ–∑ WebSocket/REST/File
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∫ –Ω–æ–≤—ã–µ —Ñ–∞–∑—ã
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

5. **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞**
   - –ê–≥–µ–Ω—Ç –ù–ï –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ Initial Prompt
   - –ñ–¥–µ—Ç –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
   - –ö–∞–∂–¥–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è = –Ω–æ–≤–∞—è —Ñ–∞–∑–∞ (phase-1, phase-2, etc.)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `logs/ai-agent2-*.log`:
```
[2025-01-31T...] [STEP-1] [AI-Agent2] [waiting_instructions] [initial] [UPTIME:45s] ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π...
```

### –°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞
```bash
curl http://localhost:3021/status
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
```json
{
  "agentId": "AI-Agent2",
  "status": "waiting_instructions",
  "currentPhase": "initial", 
  "tasksCompleted": 0,
  "uptime": 45,
  "interfaces": {
    "websocket": "active",
    "rest": "active", 
    "file": "active"
  },
  "agent1Connection": {
    "isConnected": true,
    "handshakeComplete": true
  }
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–æ—Ä—Ç—ã
- **Agent1 TCP:** 3001
- **WebSocket:** 3020  
- **REST API:** 3021

### Initial Prompt
–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∫–æ–¥–µ (`AITaskManager.initialPrompt`):
```javascript
this.initialPrompt = "–í–∞—à–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è AI –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è";
```

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞
npm run ai-agent

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
curl -X POST http://localhost:3021/instruction \
  -H "Content-Type: application/json" \
  -d '{"instruction": "–ü—Ä–∏–≤–µ—Ç! –í—ã–ø–æ–ª–Ω–∏ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É"}'
```

### 2. –§–∞–π–ª–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
echo "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞–ø–∫—É logs –∏ –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤" > instructions/analyze_logs.txt

# –ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–∞–π–ª
# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ results/processed-*-analyze_logs.txt
```

### 3. WebSocket –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```javascript
const WebSocket = require('ws');
const ws = new WebSocket('ws://localhost:3020');

ws.on('open', () => {
    console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ AI Agent');
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
    setTimeout(() => ws.send('–§–∞–∑–∞ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è'), 1000);
    setTimeout(() => ws.send('–§–∞–∑–∞ 2: –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö'), 3000);
    setTimeout(() => ws.send('–§–∞–∑–∞ 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞'), 5000);
});

ws.on('message', (data) => {
    const response = JSON.parse(data);
    console.log('–§–∞–∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞:', response);
});
```

## üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å –∞–≥–µ–Ω—Ç–æ–º
# –∏–ª–∏
pkill -f "node cursor-agent-secondary.js"
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
tail -f logs/ai-agent2-*.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
```bash
# WebSocket
curl -I http://localhost:3020

# REST API  
curl http://localhost:3021/status

# –§–∞–π–ª–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
ls -la instructions/ results/
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TD
    A[AI Background Agent] --> B[Initial Prompt]
    B --> C[WebSocket :3020]
    B --> D[REST API :3021] 
    B --> E[File Monitor]
    B --> F[Agent1 TCP :3001]
    
    C --> G[External Instruction]
    D --> G
    E --> G
    
    G --> H[Phase Processor]
    H --> I[AI Task Manager]
    I --> J[Save Results]
    J --> K[Wait for Next Instruction]
    K --> G
```

–ê–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–º —Ü–∏–∫–ª–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –∫–∞–∂–¥—É—é –Ω–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ–∞–∑—É –∑–∞–¥–∞—á–∏. 